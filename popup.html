<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🚀 AI 프롬프트 엔지니어</h1>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="progressText" class="progress-text"></div>
        </header>

        <hr>

        <main id="promptFlowContainer">
            <div id="step1" class="flow-step active">
                <h2 class="step-title">1. 어떤 작업을 도와드릴까요?</h2>
                <div class="goal-grid">
                    <button class="goal-btn" data-goal="요약">📝<br>글 요약하기</button>
                    <button class="goal-btn" data-goal="브레인스토밍">💡<br>브레인스토밍</button>
                    <button class="goal-btn" data-goal="코드 분석">💻<br>코드 분석하기</button>
                    <button class="goal-btn" data-goal="자유 질문">✍️<br>자유 질문</button>
                </div>
                <hr class="subtle-hr">
                <button id="quickStartButton" class="quick-start-btn">⚡ 빠른 질문 시작하기</button>
            </div>

            <div id="step2" class="flow-step">
                <div class="section-header">
                     <h2 class="step-title">2. 대화 맥락 추가 (선택)</h2>
                    <div class="button-group">
                        <button id="clearContextButton">🗑️ 전체 삭제</button>
                        <button id="undoButton" title="되돌리기" disabled>↩️</button>
                    </div>
                </div>
                <div id="contextList" class="context-list">
                    <p class="placeholder">맥락을 추가하면 AI가 더 정확한 답변을 합니다.</p>
                </div>
                <div class="token-counter-container">
                    <span>수집된 토큰: <span id="tokenCounter">0</span></span>
                </div>
            </div>

            <div id="step3" class="flow-step">
                <h2 class="step-title">3. 핵심 질문 입력하기</h2>
                <div class="autocomplete-container">
                    <textarea id="questionInput" placeholder="무엇이 궁금하신가요?"></textarea>
                </div>
                 <div id="suggestionContainer" class="suggestion-container"></div>
            </div>

            <div id="step4" class="flow-step">
                <h2 class="step-title">4. 답변 스타일 다듬기</h2>
                <div class="options-grid">
                    <div class="option-group">
                        <label for="answerStyle">🎨 답변 스타일</label>
                        <select id="answerStyle">
                            <option value="핵심 요약">핵심 요약</option>
                            <option value="글머리 기호 목록" selected>글머리 기호 목록</option>
                            <option value="실행 계획 (Action Plan)">실행 계획 (Action Plan)</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="tone">🎭 어조/관점</label>
                        <select id="tone">
                            <option value="객관적 분석가" selected>객관적 분석가</option>
                            <option value="친절한 설명가">친절한 설명가</option>
                            <option value="설득하는 세일즈맨">설득하는 세일즈맨</option>
                        </select>
                    </div>
                </div>
                <button id="generateButton">✨ 최적 프롬프트 생성 ✨</button>
            </div>

            <div id="step5" class="flow-step">
                 <h2 class="step-title">🎉 완성된 최적 프롬프트</h2>
                 <div class="result-group">
                    <textarea id="resultOutput" placeholder="결과가 여기에 표시됩니다..." readonly></textarea>
                </div>
                <div class="result-actions">
                    <button id="likeButton" class="like-btn result-action-btn" title="이 조합을 템플릿으로 저장" style="display: none;">템플릿 저장</button>
                    <button id="copyButton" class="copy-btn result-action-btn">복사</button>
                    <button id="restartButton" class="nav-btn result-action-btn">처음부터 다시</button>
                </div>
            </div>

            <div class="flow-navigation">
                <button id="backButton" class="nav-btn" style="display: none;">이전</button>
                <button id="nextButton" class="nav-btn" style="display: none;">다음</button>
            </div>
        </main>

        <hr class="footer-hr">

        <div id="apiKeySection" class="section api-section" style="display: none;">
             <label class="section-title">🔑 Gemini API 키</label>
             <div class="input-group">
                <input type="password" id="apiKeyInput" placeholder="API 키를 입력하세요...">
                <button id="saveApiKeyButton">저장</button>
             </div>
             <div id="apiKeySaved" class="api-saved" style="display: none;">
                <span>API 키가 안전하게 저장되었습니다.</span>
                <button id="changeApiKeyButton">변경</button>
             </div>
             <hr class="subtle-hr">
             <div class="model-select-section">
                <label class="section-title">🤖 AI 모델 선택</label>
                <select id="modelSelect">
                    <option value="gemini-1.5-flash-latest">Gemini 1.5 Flash (빠름, 효율적)</option>
                    <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro (고성능, 정확)</option>
                </select>
             </div>
        </div>
    </div>

    <div id="templateDrawer" class="drawer" style="display: none;">
        <label class="section-title">⚡ 저장된 템플릿 사용하기</label>
        <div class="custom-dropdown">
            <button id="templateSelectButton" class="dropdown-selected">템플릿 선택...</button>
            <div id="templateDropdownContent" class="dropdown-content"></div>
        </div>
    </div>

    <div class="footer-buttons">
        <button id="templateToggleButton" class="footer-btn">📁</button>
        <button id="settingsButton" class="footer-btn">⚙️</button>
    </div>


    <div id="editTemplateModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content">
            <h3>템플릿 수정</h3>
            <div class="modal-form-group">
                <label for="editTemplateName">템플릿 이름</label>
                <input type="text" id="editTemplateName">
            </div>
            <div class="modal-form-group">
                <label for="editTemplateGoal">작업 목표</label>
                <select id="editTemplateGoal"></select>
            </div>
            <div class="modal-form-group">
                <label for="editTemplateQuestion">단순 질문</label>
                <textarea id="editTemplateQuestion"></textarea>
            </div>
            <div class="modal-options-grid">
                <div class="modal-form-group">
                    <label for="editTemplateStyle">답변 스타일</label>
                    <select id="editTemplateStyle"></select>
                </div>
                <div class="modal-form-group">
                    <label for="editTemplateTone">어조/관점</label>
                    <select id="editTemplateTone"></select>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="cancelEditButton" class="modal-btn cancel-btn">취소</button>
                <button id="saveTemplateChangesButton" class="modal-btn save-btn">저장</button>
            </div>
        </div>
    </div>

    <script src="utils.js"></script>
    <script src="api.js"></script>
    <script src="popup.js"></script>
</body>
</html>